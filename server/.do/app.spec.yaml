name: astralis-server
services:
  - name: api
    github:
      repo: astralisone/astralis-agency
      branch: main
      deploy_on_push: true
    build_command: npm run build
    run_command: npm start
    environment_slug: node-js
    instance_size_slug: basic-xxs
    instance_count: 1
    envs:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "3001"
      - key: MONGODB_URI
        value: ${MONGODB_URI}
        type: SECRET
      - key: EMAIL_USER
        value: ${EMAIL_USER}
        type: SECRET
      - key: EMAIL_APP_PASSWORD
        value: ${EMAIL_APP_PASSWORD}
        type: SECRET
      - key: CONTACT_EMAIL_RECIPIENT
        value: ${CONTACT_EMAIL_RECIPIENT}
        type: SECRET
    routes:
      - path: /api
        preserve_path_prefix: true
      - path: /
        preserve_path_prefix: false

databases:
  - engine: PG
    name: astralis-db
    num_nodes: 1
    size: db-s-1vcpu-1gb
    version: "14"
